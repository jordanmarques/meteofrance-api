package fr.jordanmarques.meteofranceapi.web

import org.springframework.boot.web.servlet.error.ErrorController
import org.springframework.web.bind.annotation.RequestMapping
import org.springframework.web.bind.annotation.ResponseBody
import org.springframework.web.bind.annotation.RestController
import javax.servlet.http.HttpServletRequest

@RestController
class CustomErrorController : ErrorController {

    @RequestMapping("/error")
    @ResponseBody
    fun handleError(request: HttpServletRequest): String {
        val code = request.getAttribute("javax.servlet.error.status_code") as Integer
        val exception = request.getAttribute("javax.servlet.error.exception") as Exception

        //language=HTML
        return """
<div style='font-family: sans-serif'>
	<p>
		<h1 style='display: -webkit-inline-box'>ERROR</h1>
		<img style='height: 50px; width: 50px' src="data:image/svg+xml;utf8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI/Pgo8IS0tIEdlbmVyYXRvcjogQWRvYmUgSWxsdXN0cmF0b3IgMTguMC4wLCBTVkcgRXhwb3J0IFBsdWctSW4gLiBTVkcgVmVyc2lvbjogNi4wMCBCdWlsZCAwKSAgLS0+CjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+CjxzdmcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgdmVyc2lvbj0iMS4xIiBpZD0iQ2FwYV8xIiB4PSIwcHgiIHk9IjBweCIgdmlld0JveD0iMCAwIDYwIDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA2MCA2MDsiIHhtbDpzcGFjZT0icHJlc2VydmUiIHdpZHRoPSI1MTJweCIgaGVpZ2h0PSI1MTJweCI+CjxnPgoJPGc+CgkJPGc+CgkJCTxwYXRoIHN0eWxlPSJmaWxsOiM5MUJBRTE7IiBkPSJNNTAuMDAzLDIxLjVjLTAuMTE1LTguNjk5LTcuMTkzLTE2LTE1LjkxOS0xNmMtNS41NTksMC0xMC43NzksMy4wMDUtMTMuNjYxLDcuMzM2ICAgICBDMTkuMTU3LDExLjk5MywxNy42MzYsMTEuNSwxNiwxMS41Yy00LjQxOCwwLTgsMy41ODItOCw4YzAsMC4xNTMsMC4wMTQsMC4zMDIsMC4wMjMsMC40NTRDOC4wMTMsMjAuMTM2LDgsMjAuMzIsOCwyMC41ICAgICBjLTMuOTg4LDEuOTEyLTcsNi40NTctNywxMS4xNTVDMSwzOC4xNyw2LjMzLDQzLjUsMTIuODQ1LDQzLjVoMjQuNTA3YzAuMTM4LDAsMC4yNzItMC4wMTYsMC40MDgtMC4wMjEgICAgIGMwLjEzNywwLjAwNSwwLjI3MSwwLjAyMSwwLjQwOCwwLjAyMWg5LjgwM0M1NC4wMzcsNDMuNSw1OSwzOC41MzcsNTksMzIuNDcyQzU5LDI3LjEwMSw1NS4xMDYsMjIuNDYxLDUwLjAwMywyMS41eiIvPgoJCQk8cGF0aCBzdHlsZT0iZmlsbDojODY5N0NCOyIgZD0iTTQ3Ljk3Miw0NC41aC05LjgwM2MtMC4xMDQsMC0wLjIwOC0wLjAwNi0wLjMxMS0wLjAxNGwtMC4xMzMtMC4wMDhsLTAuMDYzLDAuMDA4ICAgICBjLTAuMTAzLDAuMDA4LTAuMjA2LDAuMDE0LTAuMzExLDAuMDE0SDEyLjg0NUM1Ljc2Miw0NC41LDAsMzguNzM3LDAsMzEuNjU0YzAtNC43NTUsMi44NTctOS41MDYsNy4wMTYtMTEuNzczICAgICBDNy4wMDgsMTkuNzU1LDcsMTkuNjI5LDcsMTkuNWMwLTQuOTYzLDQuMDM4LTksOS05YzEuNDUxLDAsMi44NjQsMC4zNDYsNC4xMzgsMS4wMDhDMjMuMzk2LDcuMTYzLDI4LjY1NSw0LjUsMzQuMDg0LDQuNSAgICAgYzguOTQ0LDAsMTYuMzYzLDcuMTk0LDE2Ljg5MSwxNi4xOTRDNTYuMTczLDIyLjA2LDYwLDI2Ljk4Myw2MCwzMi40NzJDNjAsMzkuMTA0LDU0LjYwNCw0NC41LDQ3Ljk3Miw0NC41eiBNMzcuNzI1LDQyLjQ4ICAgICBsMC4yNywwLjAxMWMwLjA1OCwwLjAwNCwwLjExNiwwLjAwOSwwLjE3NCwwLjAwOWg5LjgwM0M1My41MDEsNDIuNSw1OCwzOC4wMDEsNTgsMzIuNDcyYzAtNC44MTYtMy41MTgtOS4xMS04LjE4Mi05Ljk4OSAgICAgbC0wLjgwNC0wLjE1MWwtMC4wMTEtMC44MTdDNDguODk1LDEzLjIzNSw0Mi4yMDIsNi41LDM0LjA4NCw2LjVjLTUuMDA3LDAtMTAuMDQyLDIuNzA0LTEyLjgyOCw2Ljg5bC0wLjU1NCwwLjgzM2wtMC44MzMtMC41NTQgICAgIEMxOC43MjEsMTIuOTA0LDE3LjM4MiwxMi41LDE2LDEyLjVjLTMuODYsMC03LDMuMTQxLTcsN2MwLDAuMDg0LDAuMDA2LDAuMTY3LDAuMDEyLDAuMjVsMC4wMTIsMC4yMDJsLTAuMDA5LDAuMTczICAgICBDOS4wMDgsMjAuMjUxLDksMjAuMzc3LDksMjAuNXYwLjYzbC0wLjU2OCwwLjI3MUM0LjcwNSwyMy4xODgsMiwyNy41LDIsMzEuNjU0QzIsMzcuNjM1LDYuODY1LDQyLjUsMTIuODQ1LDQyLjVoMjQuNTA3ICAgICBjMC4wNTksMCwwLjExNi0wLjAwNSwwLjE3NC0wLjAwOUwzNy43MjUsNDIuNDh6Ii8+CgkJPC9nPgoJCTxnPgoJCQk8cGF0aCBzdHlsZT0iZmlsbDojOTFCQUUxOyIgZD0iTTUwLjAwMywyMS41YzAsMC0yLjUzNS0wLjM3NS01LjAwMywwIi8+CgkJCTxwYXRoIHN0eWxlPSJmaWxsOiM4Njk3Q0I7IiBkPSJNNDQuOTk5LDIyLjVjLTAuNDg2LDAtMC45MTItMC4zNTQtMC45ODctMC44NWMtMC4wODMtMC41NDYsMC4yOTItMS4wNTYsMC44MzgtMS4xMzkgICAgIGMyLjU4Ny0wLjM5NCw1LjE5LTAuMDE4LDUuMy0wLjAwMWMwLjU0NiwwLjA4MSwwLjkyMywwLjU4OSwwLjg0MiwxLjEzNWMtMC4wOCwwLjU0Ny0wLjU5NSwwLjkxOS0xLjEzNCwwLjg0NCAgICAgYy0wLjAyNC0wLjAwMy0yLjQyNS0wLjM0NS00LjcwOC0wLjAwMUM0NS4wOTksMjIuNDk2LDQ1LjA0OSwyMi41LDQ0Ljk5OSwyMi41eiIvPgoJCTwvZz4KCQk8Zz4KCQkJPHBhdGggc3R5bGU9ImZpbGw6IzkxQkFFMTsiIGQ9Ik04LDE5LjVjMC00LjQxOCwzLjU4Mi04LDgtOHM4LDMuNTgyLDgsOCIvPgoJCQk8cGF0aCBzdHlsZT0iZmlsbDojODY5N0NCOyIgZD0iTTI0LDIwLjVjLTAuNTUyLDAtMS0wLjQ0Ny0xLTFjMC0zLjg1OS0zLjE0LTctNy03cy03LDMuMTQxLTcsN2MwLDAuNTUzLTAuNDQ4LDEtMSwxcy0xLTAuNDQ3LTEtMSAgICAgYzAtNC45NjMsNC4wMzgtOSw5LTlzOSw0LjAzNyw5LDlDMjUsMjAuMDUzLDI0LjU1MiwyMC41LDI0LDIwLjV6Ii8+CgkJPC9nPgoJPC9nPgoJPGc+CgkJPGNpcmNsZSBzdHlsZT0iZmlsbDojRUQ3MTYxOyIgY3g9IjMxIiBjeT0iNDMuNSIgcj0iMTIiLz4KCQk8cGF0aCBzdHlsZT0iZmlsbDojRkZGRkZGOyIgZD0iTTMyLjQxNCw0My41bDMuNTM2LTMuNTM2YzAuMzkxLTAuMzkxLDAuMzkxLTEuMDIzLDAtMS40MTRzLTEuMDIzLTAuMzkxLTEuNDE0LDBMMzEsNDIuMDg2ICAgIGwtMy41MzYtMy41MzZjLTAuMzkxLTAuMzkxLTEuMDIzLTAuMzkxLTEuNDE0LDBzLTAuMzkxLDEuMDIzLDAsMS40MTRsMy41MzYsMy41MzZsLTMuNTM2LDMuNTM2Yy0wLjM5MSwwLjM5MS0wLjM5MSwxLjAyMywwLDEuNDE0ICAgIGMwLjE5NSwwLjE5NSwwLjQ1MSwwLjI5MywwLjcwNywwLjI5M3MwLjUxMi0wLjA5OCwwLjcwNy0wLjI5M0wzMSw0NC45MTRsMy41MzYsMy41MzZjMC4xOTUsMC4xOTUsMC40NTEsMC4yOTMsMC43MDcsMC4yOTMgICAgczAuNTEyLTAuMDk4LDAuNzA3LTAuMjkzYzAuMzkxLTAuMzkxLDAuMzkxLTEuMDIzLDAtMS40MTRMMzIuNDE0LDQzLjV6Ii8+Cgk8L2c+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPGc+CjwvZz4KPC9zdmc+Cg=="/>
	</p>
	<p>${exception.message}</p>
</div>
            """
    }

    override fun getErrorPath(): String {
        return "/error"
    }

}